# this Makefile generates C code for similar SHT functions,
# from one generic code + tags (reduced code maintenance).

#first char : V,Q,S,T
# Spheroidal and Toroidal (V,S,T)
vect=-e "/^[Q\#]/d" -e "s/^[VST]//"
# Spheroidal component only (V,S)
sph=-e "/^[QT\#]/d" -e "s/^[VS]//"
# Toroidal component only (V,T)
tor=-e "/^[QS\#]/d" -e "s/^[VT]//"
# Scalar component (Q)
scal=-e "/^[VST\#]/d" -e "s/^Q//"

# second char : 1BEO
# even (1,E)
ev=-e "s/^\(.\)[1E]/\1/" -e "/^.[BO]/d"
# odd (1,O)
od=-e "s/^\(.\)[1O]/\1/" -e "/^.[BE]/d"
# both (B,E,O)
eo=-e "s/^\(.\)[EOB]/\1/" -e "/^.1/d"

#SH_to_spat
GSH=hyb_SH_to_spat.gen.c
ST=SHst_to_spat.c
Q=SH_to_spat.c
S=SHs_to_spat.c
T=SHt_to_spat.c
STE=SHest_to_spat.c
QE=SHe_to_spat.c
SE=SHes_to_spat.c
TE=SHet_to_spat.c
STO=SHost_to_spat.c
QO=SHo_to_spat.c
SO=SHos_to_spat.c
TO=SHot_to_spat.c

#spat_to_SH
GSP=hyb_spat_to_SH.gen.c
SC=spat_to_SH.c
VE=spat_to_SHst.c
SCE=spat_to_SHe.c
VEE=spat_to_SHest.c
SCO=spat_to_SHo.c
VEO=spat_to_SHost.c

#SH_to_spat_dct
GDH=dct_SH_to_spat.gen.c
STD=dct_SHst_to_spat.c
QD=dct_SH_to_spat.c
SD=dct_SHs_to_spat.c
TD=dct_SHt_to_spat.c

all: $(GSH) $(GSP) $(GDH)
	$(MAKE) $(SC)
	$(MAKE) $(Q)
	$(MAKE) $(QD)

# SH_to_spat generation
$(Q) : $(GSH) Makefile
	@echo "/// This file was automatically generated by 'make' from file '$(GSH)'." > $(ST)
	@echo "/// To modify it, please consider modifying $(GSH)" >> $(ST)
	@cp $(ST) $(S)
	@cp $(ST) $(T)
	@cp $(ST) $(Q)
	@cp $(ST) $(STE)
	@cp $(ST) $(SE)
	@cp $(ST) $(TE)
	@cp $(ST) $(QE)
	@cp $(ST) $(STO)
	@cp $(ST) $(SO)
	@cp $(ST) $(TO)
	@cp $(ST) $(QO)
#EVEN/ODD
	@sed $(eo) $(vect)  $(GSH) >> $(ST)
	@sed $(eo) $(sph)  $(GSH) >> $(S)
	@sed $(eo) $(tor)  $(GSH) >> $(T)
	@sed $(eo) $(scal)  $(GSH) >> $(Q)
#EVEN
	@sed $(ev) $(vect)  $(GSH) >> $(STE)
	@sed $(ev) $(sph)  $(GSH) >> $(SE)
	@sed $(ev) $(tor)  $(GSH) >> $(TE)
	@sed $(ev) $(scal)  $(GSH) >> $(QE)
#ODD
	@sed $(od) $(vect)  $(GSH) >> $(STO)
	@sed $(od) $(sph)  $(GSH) >> $(SO)
	@sed $(od) $(tor)  $(GSH) >> $(TO)
	@sed $(od) $(scal)  $(GSH) >> $(QO)
	@echo "SH*_to_spat code generated."

# spat_to_SH generation
$(SC) : $(GSP) Makefile
	@echo "/// This file was automatically generated by 'make' from file '$(GSP)'." > $(SC)
	@echo "/// To modify it, please consider modifying $(GSP)" >> $(SC)
	@cp $(SC) $(VE)
	@cp $(SC) $(SCE)
	@cp $(SC) $(SCO)
	@cp $(SC) $(VEE)
	@cp $(SC) $(VEO)
#EVEN/ODD
	@sed $(eo) $(scal)  $(GSP) >> $(SC)
	@sed $(eo) $(vect)  $(GSP) >> $(VE)
#EVEN
	@sed $(ev) $(scal)  $(GSP) >> $(SCE)
	@sed $(ev) $(vect)  $(GSP) >> $(VEE)
#ODD
	@sed $(od) $(scal)  $(GSP) >> $(SCO)
	@sed $(od) $(vect)  $(GSP) >> $(VEO)
	@echo "spat_to_SH* code generated."

# SH_to_spat_dct generation
$(QD) : $(GDH) Makefile
	@echo "/// This file was automatically generated by 'make' from file '$(GDH)'." > $(QD)
	@echo "/// To modify it, please consider modifying $(GDH)" >> $(QD)
	@cp $(QD) $(SD)
	@cp $(QD) $(TD)
	@cp $(QD) $(STD)
#EVEN/ODD only
	@sed $(eo) $(vect)  $(GDH) >> $(STD)
	@sed $(eo) $(sph)  $(GDH) >> $(SD)
	@sed $(eo) $(tor)  $(GDH) >> $(TD)
	@sed $(eo) $(scal)  $(GDH) >> $(QD)
	@echo "DCT_SH*_to_spat code generated."

clean: 
	rm $(ST) $(Q) $(S) $(T) $(STE) $(QE) $(SE) $(TE) $(STO) $(QO) $(SO) $(TO)
	rm $(SC) $(VE) $(SCE) $(VEE) $(SCO) $(VEO)
	rm $(STD) $(SD) $(TD) $(QD)
